var tinynlp=function(){function l(a){this.lhsToRhsList={};for(var b in a){var c=a[b].split("->"),d=c[0].trim(),c=c[1].trim().split("|");this.lhsToRhsList[d]||(this.lhsToRhsList[d]=[]);for(var e in c)this.lhsToRhsList[d].push(c[e].trim().split(" "))}}function h(a){this.idToState={};this.currentId=0;this.chart=[];for(var b=0;b<a.length+1;b++)this.chart[b]=[]}function f(a,b,c,d,e){this.lhs=a;this.rhs=b;this.dot=c;this.left=d;this.right=e;this.id=-1;this.ref=[];for(a=0;a<b.length;a++)this.ref[a]={}}function m(a,
b,c,d){if(b==a.length)d.push(c.slice());else for(var e in a[b])c.push(a[b][e]),m(a,b+1,c,d),c.pop()}l.prototype.terminalSymbols=function(a){return[]};l.prototype.getRightHandSides=function(a){return(a=this.lhsToRhsList[a])?a:null};loggingOn=!1;h.prototype.addToChart=function(a,b){a.setId(this.currentId);var c=this.chart[b],d;for(d in c){var e=c[d];if(a.equals(e)){e.appendRefsToChidStates(a.getRefsToChidStates());return}}c.push(a);this.idToState[this.currentId]=a;this.currentId++};h.prototype.getStatesInColumn=
function(a){return this.chart[a]};h.prototype.countStatesInColumn=function(a){return this.chart[a].length};h.prototype.getState=function(a){return this.idToState[a]};h.prototype.getFinishedRoot=function(a){var b=this.chart[this.chart.length-1],c;for(c in b){var d=b[c];if(d.complete()&&d.getLeftHandSide()==a)return d}return null};h.prototype.log=function(a){if(loggingOn){console.log("-------------------");console.log("Column: "+a);console.log("-------------------");for(var b in this.chart[a])console.log(this.chart[a][b].toString())}};
f.prototype.complete=function(){return this.dot>=this.rhs.length};f.prototype.toString=function(){var a=[];a.push("(id: "+this.id+")");a.push(this.lhs);a.push("\u2192");for(var b=0;b<this.rhs.length;b++)b==this.dot&&a.push("\u2022"),a.push(this.rhs[b]);this.complete()&&a.push("\u2022");a.push("["+this.left+", "+this.right+"]");a.push(JSON.stringify(this.ref));return a.join(" ")};f.prototype.expectedNonTerminal=function(a){return null!==a.getRightHandSides(this.rhs[this.dot])?!0:!1};f.prototype.setId=
function(a){this.id=a};f.prototype.getId=function(){return this.id};f.prototype.equals=function(a){return this.lhs===a.lhs&&this.dot===a.dot&&this.left===a.left&&this.right===a.right&&JSON.stringify(this.rhs)===JSON.stringify(a.rhs)?!0:!1};f.prototype.getRefsToChidStates=function(){return this.ref};f.prototype.appendRefsToChidStates=function(a){for(var b=0;b<a.length;b++)if(a[b])for(var c in a[b])this.ref[b][c]=a[b][c]};f.prototype.predictor=function(a,b){var c=this.rhs[this.dot],d=a.getRightHandSides(c),
e;for(e in d){var g=new f(c,d[e],0,this.right,this.right);b.addToChart(g,this.right)}};f.prototype.scanner=function(a,b,c){var d=this.rhs[this.dot];a=c?a.terminalSymbols(c):[];a.push(c);for(var e in a)if(d==a[e]){c=new f(d,[c],1,this.right,this.right+1);b.addToChart(c,this.right+1);break}};f.prototype.completer=function(a){var b=a.getStatesInColumn(this.left),c;for(c in b){var d=b[c];if(d.rhs[d.dot]==this.lhs){var e=new f(d.lhs,d.rhs,d.dot+1,d.left,this.right);e.appendRefsToChidStates(d.ref);var g=
Array(d.rhs.length);g[d.dot]={};g[d.dot][this.id]=this;e.appendRefsToChidStates(g);a.addToChart(e,this.right)}}};f.prototype.traverse=function(){if(1==this.ref.length&&0==Object.keys(this.ref[0]).length){var a=[];this.lhs!=this.rhs&&a.push({root:this.rhs});return[{root:this.lhs,subtrees:a}]}for(var b=[],a=0;a<this.ref.length;a++){b[a]=[];for(var c in this.ref[a])b[a]=b[a].concat(this.ref[a][c].traverse())}c=[];m(b,0,[],c);b=[];for(a in c)b.push({root:this.lhs,subtrees:c[a]});return b};f.prototype.getLeftHandSide=
function(){return this.lhs};var k={};k.Grammar=l;k.State=f;k.Chart=h;k.parse=function(a,b,c){var d=new h(a),e=b.getRightHandSides(c),g;for(g in e){var k=new f(c,e[g],0,0,0);d.addToChart(k,0)}for(g=0;g<a.length+1;g++){for(j=0;j<d.countStatesInColumn(g);)c=d.getStatesInColumn(g)[j],c.complete()?c.completer(d):c.expectedNonTerminal(b)?c.predictor(b,d):c.scanner(b,d,a[g]),j++;d.log(g)}return d};k.logging=function(a){loggingOn=a};return k}();